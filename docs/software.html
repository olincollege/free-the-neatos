<!DOCTYPE html>
<html lang="en">

<!--The head contains metadata about our page and it's the place where we can load css files (for -->
<!--styling) and javascript files.-->
<head>

    <meta name="author" content="Stephan Risi">
    <meta charset="utf-8">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">-->
    
    <!-- Favicon -->
    <link rel="icon" type="image/jpeg" href="images/home.jpg">

    <!-- Load JQuery and Bootstrap. They are javascript library that handle the layouting for us.-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <!--Set the title for the page-->
    <title>Software - Free the Neatos</title>

    <!-- The nav bar remains the same for every page, so by defining it in only one file, we only
     need to edit it in one place when we make changes to it. -->
    <script> $(function(){$("#header").load("header.html");});</script>

    <!-- Import the css file, which defines how our website looks -->
    <link href="css/main.css" rel="stylesheet">

    <script>
        // Mobile menu toggle functionality - use event delegation since header loads asynchronously
        $(document).ready(function() {
            function setupMobileMenu() {
                // Toggle mobile menu - use event delegation
                $(document).off('click', '.mobile-menu-toggle').on('click', '.mobile-menu-toggle', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    var isActive = $(this).hasClass('active');
                    $(this).toggleClass('active');
                    $('.sidebar').toggleClass('active');
                    $('.mobile-overlay').toggleClass('active');
                    // Prevent body scroll when menu is open
                    if (!isActive) {
                        $('body').addClass('menu-open');
                    } else {
                        $('body').removeClass('menu-open');
                    }
                });

                // Close menu when overlay is clicked
                $(document).off('click', '.mobile-overlay').on('click', '.mobile-overlay', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    $('.mobile-menu-toggle').removeClass('active');
                    $('.sidebar').removeClass('active');
                    $(this).removeClass('active');
                    $('body').removeClass('menu-open');
                });
            }

            // Set up mobile menu immediately and after delays to ensure header is loaded
            setupMobileMenu();
            setTimeout(setupMobileMenu, 100);
            setTimeout(setupMobileMenu, 500);
            setTimeout(setupMobileMenu, 1000);
        });

        // Close menu when a nav link is clicked (on mobile) - use event delegation
        $(document).on('click', '.nav-link', function() {
            if ($(window).width() <= 767) {
                $('.mobile-menu-toggle').removeClass('active');
                $('.sidebar').removeClass('active');
                $('.mobile-overlay').removeClass('active');
                $('body').removeClass('menu-open');
            }
        });

        // Set up active links after header loads
        $(document).ready(function() {
            function setupNavigation() {
                var currentPage = window.location.pathname.split('/').pop() || 'index.html';
                var isMilestonePage = currentPage.includes('milestone');
                var isSoftwarePage = currentPage.includes('software');
                
                $('.nav-link').each(function() {
                    var linkHref = $(this).attr('href');
                    if (!linkHref) return;
                    
                    var linkPage = linkHref.split('#')[0].split('/').pop();
                    
                    // Check if this link matches current page
                    if (linkPage === currentPage || 
                        (currentPage === '' && linkPage === 'index.html') ||
                        (isMilestonePage && linkHref.includes('milestone') && currentPage === linkPage) ||
                        (isSoftwarePage && linkHref.includes('software') && currentPage === linkPage)) {
                        $(this).addClass('active');
                    }
                });
            }

            // Try to set up navigation immediately, and also after a short delay to ensure header is loaded
            setTimeout(setupNavigation, 100);
            setTimeout(setupNavigation, 500);
        });
    </script>

</head>

<!--We define the elements that we actually want to display in the body element-->
<body>
    <!--This element is a placeholder for the sidebar navigation, which we load above-->
    <div id="header"></div>

    <!--Main content area-->
    <main class="main-content">
        <div class="content-wrapper">
            <h1>Software</h1>
            
            <h2>Architecture</h2>
            
            <p>
                We've organized our software into distinct functional modes to clearly separate the different behaviors our Neato robots need. This modular approach makes it easier to understand, maintain, and extend the system. The software is split into four main sections: Mapping Mode (for exploring and building maps of new environments), Cleaning Mode (for efficiently covering and cleaning known spaces), Localization (for pose estimation), and Shared Algorithms (common utilities used by both modes).
            </p>
            
            <h3>Mapping Mode</h3>
            <ul>
                <li>SLAM Toolbox (launch file)</li>
                <li>Mapping (Node):
                    <ul>
                        <li>Identify new frontiers</li>
                        <li>Call A* for waypoint planning</li>
                        <li>Call action server to execute</li>
                    </ul>
                </li>
            </ul>
            
            <h3>Cleaning Mode</h3>
            <ul>
                <li>Cleaning (Node)</li>
                <li>Call coverage path planning function</li>
                <li>Call A* to get from cell to cell</li>
                <li>Call action server to execute</li>
                <li>Coverage path planning with Boustrophedon cellular decomposition (Functions)</li>
            </ul>

            <h3>Localization</h3>
            <ul>
                <li>Kalman Filter for localization (Node)</li>
            </ul>
            
            <h3>Both (Shared Algorithms)</h3>
            <ul>
                <li>A* on map (Function)</li>
                <li>Visit waypoints (action server)
                    <ul>
                        <li>Uses proportional controller</li>
                    </ul>
                </li>
            </ul>
            
            <p>
                This is the system architecture diagram showing the overall structure of the Free the Neatos project.
            </p>
            <p>
                <img src="images/image4.jpg" alt="System Architecture" class="content-img" />
            </p>
        </div>
    </main>
</body>
</html>
